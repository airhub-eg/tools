# Exercise 11: Testing with CTest (Advanced)

**Task**: Set up a testing framework using CTest.

**Requirements**:
- Enable testing with CTest
- Create at least 3 different tests
- One test should intentionally fail
- Use test properties to set timeouts
- Create a test that checks program output

<details>
<summary>Solution</summary>

**CMakeLists.txt**:
```cmake
cmake_minimum_required(VERSION 3.15)
project(TestingProject)

# Enable testing
enable_testing()

# Main library
add_library(mathlib STATIC math_ops.cpp)
target_include_directories(mathlib PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})

# Test executables
add_executable(test_addition test_addition.cpp)
target_link_libraries(test_addition PRIVATE mathlib)

add_executable(test_multiplication test_multiplication.cpp)
target_link_libraries(test_multiplication PRIVATE mathlib)

add_executable(test_division test_division.cpp)
target_link_libraries(test_division PRIVATE mathlib)

add_executable(test_output test_output.cpp)

# Add tests
add_test(NAME AdditionTest COMMAND test_addition)
add_test(NAME MultiplicationTest COMMAND test_multiplication)
add_test(NAME DivisionTest COMMAND test_division)
add_test(NAME OutputTest COMMAND test_output)

# Set test properties
set_tests_properties(AdditionTest PROPERTIES
    TIMEOUT 5
    PASS_REGULAR_EXPRESSION "All addition tests passed"
)

set_tests_properties(OutputTest PROPERTIES
    PASS_REGULAR_EXPRESSION "Expected output: 42"
)

# This test will fail intentionally
set_tests_properties(DivisionTest PROPERTIES
    WILL_FAIL TRUE
    TIMEOUT 5
)
```

**math_ops.h**:
```cpp
#ifndef MATH_OPS_H
#define MATH_OPS_H

int add(int a, int b);
int multiply(int a, int b);
int divide(int a, int b);

#endif
```

**math_ops.cpp**:
```cpp
#include "math_ops.h"

int add(int a, int b) {
    return a + b;
}

int multiply(int a, int b) {
    return a * b;
}

int divide(int a, int b) {
    if (b == 0) return 0;  // Simplified error handling
    return a / b;
}
```

**test_addition.cpp**:
```cpp
#include "math_ops.h"
#include <iostream>
#include <cassert>

int main() {
    assert(add(2, 3) == 5);
    assert(add(-1, 1) == 0);
    assert(add(0, 0) == 0);
    assert(add(100, 200) == 300);
    
    std::cout << "All addition tests passed" << std::endl;
    return 0;
}
```

**test_multiplication.cpp**:
```cpp
#include "math_ops.h"
#include <iostream>
#include <cassert>

int main() {
    assert(multiply(2, 3) == 6);
    assert(multiply(-2, 3) == -6);
    assert(multiply(0, 100) == 0);
    
    std::cout << "All multiplication tests passed" << std::endl;
    return 0;
}
```

**test_division.cpp**:
```cpp
#include "math_ops.h"
#include <iostream>
#include <cassert>

int main() {
    assert(divide(6, 2) == 3);
    assert(divide(10, 5) == 2);
    
    // This assertion will fail, causing the test to fail
    assert(divide(5, 2) == 3);  // Should be 2, not 3
    
    std::cout << "All division tests passed" << std::endl;
    return 0;
}
```

**test_output.cpp**:
```cpp
#include <iostream>

int main() {
    std::cout << "Expected output: 42" << std::endl;
    return 0;
}
```

**Running tests**:
```bash
mkdir build && cd build
cmake ..
cmake --build .
ctest

# Verbose output
ctest --verbose

# Run specific test
ctest -R Addition

# Show only failed tests
ctest --output-on-failure
```

</details>
