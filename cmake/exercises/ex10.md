# Exercise 10: Custom Commands (Advanced)

**Task**: Use custom commands to generate code during the build process.

**Requirements**:
- Create a Python script that generates a C++ header file
- Run this script automatically during the build
- Use the generated header in your application
- Make sure the generation happens before compilation

<details>
<summary>Solution</summary>

**CMakeLists.txt**:
```cmake
cmake_minimum_required(VERSION 3.15)
project(CodeGeneration)

# Find Python
find_package(Python3 REQUIRED COMPONENTS Interpreter)

# Define output file
set(GENERATED_HEADER ${CMAKE_CURRENT_BINARY_DIR}/generated/version.h)

# Custom command to generate header
add_custom_command(
    OUTPUT ${GENERATED_HEADER}
    COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_CURRENT_BINARY_DIR}/generated
    COMMAND ${Python3_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/generate_version.py 
            ${GENERATED_HEADER}
            ${PROJECT_VERSION}
    DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/generate_version.py
    COMMENT "Generating version header..."
    VERBATIM
)

# Create a custom target that depends on the generated file
add_custom_target(generate_headers DEPENDS ${GENERATED_HEADER})

# Create executable
add_executable(app main.cpp ${GENERATED_HEADER})

# Make sure generation happens before compilation
add_dependencies(app generate_headers)

# Add the generated directory to include path
target_include_directories(app PRIVATE ${CMAKE_CURRENT_BINARY_DIR}/generated)
```

**generate_version.py**:
```python
#!/usr/bin/env python3
import sys
from datetime import datetime

if len(sys.argv) < 3:
    print("Usage: generate_version.py <output_file> <version>")
    sys.exit(1)

output_file = sys.argv[1]
version = sys.argv[2] if len(sys.argv) > 2 else "0.0.0"

header_content = f"""// Auto-generated file - do not edit manually
#ifndef VERSION_H
#define VERSION_H

#define VERSION_STRING "{version}"
#define BUILD_DATE "{datetime.now().strftime('%Y-%m-%d')}"
#define BUILD_TIME "{datetime.now().strftime('%H:%M:%S')}"

#endif // VERSION_H
"""

with open(output_file, 'w') as f:
    f.write(header_content)

print(f"Generated {output_file}")
```

**main.cpp**:
```cpp
#include <iostream>
#include "version.h"

int main() {
    std::cout << "Application Version: " << VERSION_STRING << std::endl;
    std::cout << "Built on: " << BUILD_DATE << " at " << BUILD_TIME << std::endl;
    return 0;
}
```

**Make the Python script executable**:
```bash
chmod +x generate_version.py
```

</details>
